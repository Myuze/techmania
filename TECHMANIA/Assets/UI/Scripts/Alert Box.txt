alertBox = {
    bg = tm.root.Q("alert-box-background"),
    
    confirmCallback = nil,
    cancelCallback = nil
}

function FadeInDialog(bg, dialog)
    bg.display = true
    tm.StartCoroutine(function()
        FadeInCoroutine(dialog, 0, -100)
    end)
end

-- finishCallback will be called after the dialog fully fades out
-- and bg disappears.
function FadeOutDialog(bg, dialog, finishCallback)
    tm.StartCoroutine(function()
        FadeOutCoroutine(dialog, 0, -100, function()
            bg.display = false
            if (finishCallback != nil) then
                finishCallback()
            end
        end)
    end)
end

alertBox.Alert = function(message, confirmText, callback)
    local bg = alertBox.bg
    bg.Q("alert-text").text = message
    if (confirmText == nil) then
        confirmText = tm.l10n.GetString("alert_ok")
    end
    bg.Q("confirm-button").text = confirmText
    bg.Q("cancel-button").display = false
    alertBox.confirmCallback = callback
    alertBox.cancelCallback = callback
    FadeInDialog(bg, bg.Q("alert-box"))
end

alertBox.Confirm = function(message, confirmText, cancelText, confirmCallback)
    local bg = alertBox.bg
    bg.Q("alert-text").text = message
    bg.Q("confirm-button").text = confirmText
    bg.Q("cancel-button").display = true
    bg.Q("cancel-button").text = cancelText
    alertBox.confirmCallback = confirmCallback
    alertBox.cancelCallback = nil
    FadeInDialog(bg, bg.Q("alert-box"))
end

alertBox.Initialize = function()
    local bg = alertBox.bg
    bg.display = false
    bg.Q("confirm-button").RegisterCallback(eventType.Click, function()
        FadeOutDialog(bg, bg.Q("alert-box"))
        if (alertBox.confirmCallback != nil) then
            alertBox.confirmCallback()
        end
    end)

    function OnCancel()
        FadeOutDialog(bg, bg.Q("alert-box"))
        if (alertBox.cancelCallback != nil) then
            alertBox.cancelCallback()
        end
    end
    bg.Q("cancel-button").RegisterCallback(eventType.Click, OnCancel)
    bg.RegisterCallback(eventType.Click, OnCancel)
    bg.RegisterCallback(eventType.Click, function(element, event)
        tm.audio.Play(util.io.LoadAudioFromTheme("Assets/UI/SFX/Back.wav"), tm.enum.audioChannel.SFX)
    end)

    bg.Q("alert-box").RegisterCallback(eventType.Click, function(element, event)
        -- Prevents bg from receiving this event on the bubble up phase
        event.StopPropagation()
    end)
end

alertBox.Initialize()