alertBoxConfirmCallback = nil
alertBoxCancelCallback = nil

function FadeInDialog(bg, dialog)
    bg.display = true
    tm.StartCoroutine(function()
        FadeInCoroutine(tm, dialog, 0, -100)
    end)
end

function FadeOutDialog(bg, dialog, finishCallback)
    tm.StartCoroutine(function()
        FadeOutCoroutine(tm, dialog, 0, -100, function()
            bg.display = false
            if (finishCallback != nil) then
                finishCallback()
            end
        end)
    end)
end

function Alert(message, confirmText, callback)
    local bg = tm.root.Q("alert-box-background")
    bg.Q("alert-text").text = message
    if (confirmText == nil) then
        confirmText = tm.l10n.GetString("alert_ok")
    end
    bg.Q("confirm-button").text = confirmText
    bg.Q("cancel-button").display = false
    alertBoxConfirmCallback = callback
    alertBoxCancelCallback = callback
    FadeInDialog(bg, bg.Q("alert-box"))
end

function Confirm(message, confirmText, cancelText, confirmCallback)
    local bg = tm.root.Q("alert-box-background")
    bg.Q("alert-text").text = message
    bg.Q("confirm-button").text = confirmText
    bg.Q("cancel-button").display = true
    bg.Q("cancel-button").text = cancelText
    alertBoxConfirmCallback = confirmCallback
    alertBoxCancelCallback = nil
    FadeInDialog(bg, bg.Q("alert-box"))
end

function InitializeAlertBox(tm)
    local bg = tm.root.Q("alert-box-background")
    bg.display = false
    bg.Q("confirm-button").RegisterCallback("Click", function()
        FadeOutDialog(bg, bg.Q("alert-box"))
        if (alertBoxConfirmCallback != nil) then
            alertBoxConfirmCallback()
        end
    end)

    function OnCancel()
        FadeOutDialog(bg, bg.Q("alert-box"))
        if (alertBoxCancelCallback != nil) then
            alertBoxCancelCallback()
        end
    end
    bg.Q("cancel-button").RegisterCallback("Click", OnCancel)
    bg.RegisterCallback("Click", OnCancel)
    bg.RegisterCallback("Click", function(element, event)
        tm.audio.Play(util.io.LoadAudioFromTheme("Assets/UI/SFX/Back.wav"), "SFX")
    end)

    bg.Q("alert-box").RegisterCallback("Click", function(element, event)
        -- Prevents bg from receiving this event on the bubble up phase
        event.StopPropagation()
    end)
end

InitializeAlertBox(tm)