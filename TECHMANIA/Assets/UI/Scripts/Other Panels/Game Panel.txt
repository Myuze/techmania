function InitializeGamePanel(tm)
    local panel = tm.root.Q("game-panel")

    panel.Q("pause-button").RegisterCallback("Click", function()
    end)

    panel.Q("fever-bar-bg").RegisterCallback("PointerDown", function()
    end)

    tm.gameSetup.bgContainer = panel.Q("bg-layer")
    tm.gameSetup.gameContainer = panel.Q("game-layer")
    tm.gameSetup.vfxComboContainer = nil  -- Unused

    tm.gameSetup.onStateChange = function(newState)
        print("State changed to: " .. newState)
        if (newState == "LoadComplete") then
            GamePanelBeginGame(tm, panel)
        end
    end

    tm.gameSetup.onLoadProgress = function(progress)
        local percent = progress.filesLoaded * 100 / progress.totalFiles
        SetProgressBar(panel.Q("loading-progress"), percent)
    end

    tm.gameSetup.onLoadError = function(status)
        tm.game.Conclude()
        Alert(status.errorMessage, nil, function()
            GamePanelToSelectPatternPanel(tm)
        end)
    end

    tm.gameSetup.onUpdate = function()
    end

    tm.gameSetup.onNoteResolved = function()
    end

    tm.gameSetup.onFeverUpdate = function(fever)
    end

    tm.gameSetup.onFeverEnd = function(feverBonus)
    end
end

function GamePanelStartLoading(tm)
    local panel = tm.root.Q("game-panel")

    panel.Q("top-bar").visible = false  -- Cannot turn off display as it influences #remaining-space
    panel.Q("top-bar").Q("pause-button").display = true
    panel.Q("top-bar").Q("back-button").display = false
    panel.Q("top-bar").Q("regular-top-bar").display = tm.options.modifiers.mode != "Practice"
    panel.Q("top-bar").Q("practice-top-bar").display = tm.options.modifiers.mode == "Practice"
    panel.Q("middle-fever-bar-bg").display = false
    panel.Q("loading-bar-wrap").display = themeOptions.Get("showLoadingBar") == "True"
    panel.InsertChild(0, panel.Q("bg-layer"))

    -- TODO: respond to showFps option
    -- TODO: respond to showJudgementTally option
    -- TODO: respond to showLaneDividers option
    -- TODO: respond to beatMarkers option
end

function GamePanelBeginGame(tm, panel)
    if (themeOptions.Get("backgroundScalingMode") == "FillGameArea") then
        panel.Q("remaining-space").InsertChild(0, panel.Q("bg-layer"))
    end

    panel.Q("top-bar").visible = true
    panel.Q("middle-fever-bar-bg").display = true
    panel.Q("loading-bar-wrap").display = false

    tm.game.Begin()
end

InitializeGamePanel(tm)