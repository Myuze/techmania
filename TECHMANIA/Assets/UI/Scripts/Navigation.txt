mainMenu = {
    panel = tm.root.Q("main-menu"),

    Show = function()
        tm.SetDiscordActivity("", tm.l10n.GetString("discord_state_main_menu"))
    end
}

navigation = {
    -- TODO: refactor this. Maybe each panel will have a
    -- Show() and Hide() function?
    MainMenuToSelectTrackPanel = function()
        panelTransition.FromRight(
            mainMenu.panel,
            selectTrackPanel.panel,
            function()
                selectTrackPanel.inEditor = false
                selectTrackPanel.Show()
            end
        )
    end,
    SelectTrackPanelToMainMenu = function()
        panelTransition.FromLeft(
            selectTrackPanel.panel,
            mainMenu.panel,
            function()
                selectTrackPanel.Hide()
                mainMenu.Show()
            end
        )
    end,

    SelectTrackPanelToSelectPatternPanel = function()
        panelTransition.FromRight(
            selectTrackPanel.panel,
            selectPatternPanel.panel,
            function()
                selectTrackPanel.Hide()
                selectPatternPanel.Show()
            end
        )
        
    end,
    SelectPatternPanelToSelectTrackPanel = function()
        panelTransition.FromLeft(
            selectPatternPanel.panel,
            selectTrackPanel.panel,
            function()
                selectPatternPanel.Hide()
                selectTrackPanel.Show()
            end
        )
    end,

    SelectPatternPanelToSelectSkinPanel = function()
        panelTransition.FromRight(
            selectPatternPanel.panel,
            selectSkinPanel.panel,
            function()
                selectPatternPanel.Hide()
                selectSkinPanel.panelToGoBackTo = selectPatternPanel
                selectSkinPanel.Show()
            end
        )
    end,
    SelectSkinPanelToSelectPatternPanel = function()
        panelTransition.FromLeft(
            selectSkinPanel.panel,
            selectPatternPanel.panel,
            function()
                selectSkinPanel.Hide()
                selectPatternPanel.Show()
            end
        )
    end,

    SelectPatternPanelToGamePanel = function()
        panelTransition.FadeToBlack(
            selectPatternPanel.panel,
            gamePanel.panel,
            function()
                selectPatternPanel.Hide()
                gamePanel.inEditor = false
                gamePanel.Show()
            end
        )
        
    end,
    GamePanelToSelectTrackPanel = function()
        panelTransition.FadeToBlack(
            gamePanel.panel,
            selectTrackPanel.panel,
            function()
                gamePanel.Hide()
                selectTrackPanel.Show()
            end
        )
    end,

    GamePanelToResultPanel = function()
        panelTransition.FadeToBlack(
            gamePanel.panel,
            resultPanel.panel,
            function()
                resultPanel.Show()
            end
        )
    end,
    ResultPanelToGamePanel = function()
        panelTransition.FadeToBlack(
            resultPanel.panel,
            gamePanel.panel,
            function()
                gamePanel.Show()
            end
        )
    end,
    ResultPanelToSelectTrackPanel = function()
        panelTransition.FromRight(
            resultPanel.panel,
            selectTrackPanel.panel,
            function()
                selectTrackPanel.Show()
            end
        )
    end,

    MainMenuToEditorSelectTrackPanel = function()
        panelTransition.FromRight(
            mainMenu.panel,
            selectTrackPanel.panel,
            function()
                selectTrackPanel.inEditor = true
                selectTrackPanel.Show()
            end
        )
    end,

    EditorSelectTrackPanelToEditor = function(trackFolder)
        panelTransition.FromRight(
            selectTrackPanel.panel,
            nil,
            function()
                selectTrackPanel.Hide()
                tm.editor.LaunchOnTrack(trackFolder)
            end
        )
    end,
    EditorToEditorSelectTrackPanel = function()
        panelTransition.FromLeft(
            nil,
            selectTrackPanel.panel,
            function()
                selectTrackPanel.Show()
            end
        )
    end,

    EditorToGamePanel = function()
        panelTransition.FromRight(
            nil,
            gamePanel.panel,
            function()
                gamePanel.inEditor = true
                gamePanel.Show()
            end
        )
    end,
    GamePanelToEditor = function()
        panelTransition.FromLeft(
            gamePanel.panel,
            nil,
            function()
                gamePanel.Hide()
                tm.editor.ReturnFromPreview()
            end
        )
    end,

    MainMenuToOptionsPanel = function()
        panelTransition.FromRight(
            mainMenu.panel,
            optionsPanel.panel,
            function()
                optionsPanel.Show()
            end
        )
    end,
    OptionsPanelToMainMenu = function()
        panelTransition.FromLeft(
            optionsPanel.panel,
            mainMenu.panel,
            function()
                optionsPanel.Hide()
                mainMenu.Show()
            end
        )
    end,

    OptionsPanelToTouchscreenTestPanel = function()
        panelTransition.FromRight(
            optionsPanel.panel,
            touchscreenTestPanel.panel
        )
    end,
    TouchscreenTestPanelToOptionsPanel = function()
        panelTransition.FromLeft(
            touchscreenTestPanel.panel,
            optionsPanel.panel,
            function()
                touchscreenTestPanel.Hide()
            end
        )
    end,

    OptionsPanelToSelectSkinPanel = function()
        panelTransition.FromRight(
            optionsPanel.panel,
            selectSkinPanel.panel,
            function()
                selectSkinPanel.panelToGoBackTo = optionsPanel
                selectSkinPanel.Show()
            end
        )
    end,
    SelectSkinPanelToOptionsPanel = function()
        panelTransition.FromLeft(
            selectSkinPanel.panel,
            optionsPanel.panel,
            function()
                selectSkinPanel.Hide()
            end
        )
    end,

    MainMenuToInformationPanel = function()
        panelTransition.FromRight(
            mainMenu.panel,
            infoPanel.panel,
            function()
                infoPanel.Show()
            end
        )
    end,
    InformationPanelToMainMenu = function()
        panelTransition.FromLeft(
            infoPanel.panel,
            mainMenu.panel,
            function()
                mainMenu.Show()
            end
        )
    end
}

function SetUpNavigation()
    function GoBackFromSelectSkinPanel()
        if (selectSkinPanel.panelToGoBackTo == selectPatternPanel) then
            navigation.SelectSkinPanelToSelectPatternPanel()
        elseif (selectSkinPanel.panelToGoBackTo == optionsPanel) then
            navigation.SelectSkinPanelToOptionsPanel()
        end
    end

    mainMenu.panel.Q("start-button").RegisterCallback(eventType.Click,
        navigation.MainMenuToSelectTrackPanel)
    selectTrackPanel.panel.Q("back-button").RegisterCallback(eventType.Click,
        navigation.SelectTrackPanelToMainMenu)

    -- select track panel --> select pattern panel is registered on track cards,
    -- handled by Select Track Panel.txt
    selectPatternPanel.panel.Q("back-button").RegisterCallback(eventType.Click,
        navigation.SelectPatternPanelToSelectTrackPanel)

    selectPatternPanel.panel.Q("modifier-sidesheet").Q("skins").Q("select-button").RegisterCallback(eventType.Click,
        navigation.SelectPatternPanelToSelectSkinPanel)
    selectSkinPanel.panel.Q("back-button").RegisterCallback(eventType.Click,
        GoBackFromSelectSkinPanel)

    selectPatternPanel.panel.Q("play-button").RegisterCallback(eventType.Click,
        navigation.SelectPatternPanelToGamePanel)
    -- game panel --> select track panel can happen on multiple occasions, so it's a separate
    -- function, found below.

    -- game panel --> result panel can happen on multiple occasions, so it's a separate function,
    -- found below.
    resultPanel.panel.Q("retry-button").RegisterCallback(eventType.Click,
        navigation.ResultPanelToGamePanel)
    resultPanel.panel.Q("select-track-button").RegisterCallback(eventType.Click,
        navigation.ResultPanelToSelectTrackPanel)

    mainMenu.panel.Q("editor-button").RegisterCallback(eventType.Click,
        navigation.MainMenuToEditorSelectTrackPanel)
    -- select track panel (editor) --> editor is registered on track cards,
    -- handled by Select Track Panel.txt
    tm.editor.onExit = navigation.EditorToEditorSelectTrackPanel

    tm.editor.onPreview = function(trackFolder, track, pattern)
        selectTrackPanel.selectedTrackFolder = trackFolder
        selectTrackPanel.selectedFullTrack = track
        selectPatternPanel.selectedPattern = pattern
        navigation.EditorToGamePanel()
    end
    gamePanel.panel.Q("back-button").RegisterCallback(eventType.Click,
        navigation.GamePanelToEditor)

    mainMenu.panel.Q("options-button").RegisterCallback(eventType.Click,
        navigation.MainMenuToOptionsPanel)
    optionsPanel.panel.Q("back-button").RegisterCallback(eventType.Click,
        navigation.OptionsPanelToMainMenu)

    optionsPanel.panel.Q("touchscreen-test").Q("button").RegisterCallback(eventType.Click,
        navigation.OptionsPanelToTouchscreenTestPanel)
    touchscreenTestPanel.panel.Q("back-button").RegisterCallback(eventType.Click,
        navigation.TouchscreenTestPanelToOptionsPanel)

    optionsPanel.panel.Q("skins").Q("button").RegisterCallback(eventType.Click,
        navigation.OptionsPanelToSelectSkinPanel)
    -- Select skin panel --> options panel is covered in GoBackFromSelectSkinPanel()

    mainMenu.panel.Q("information-button").RegisterCallback(eventType.Click,
        navigation.MainMenuToInformationPanel)
    infoPanel.panel.Q("back-button").RegisterCallback(eventType.Click,
        navigation.InformationPanelToMainMenu)

    mainMenu.panel.Q("quit-button").RegisterCallback(eventType.Click, function()
        tm.Quit()
    end)
end
